#!/bin/bash
# Copyright 2021 Digital Aggregates Corporation, Colorado, USA
# Licensed under the terms in LICENSE.txt
# Chip Overclock <coverclock@diag.com>
# https://github.com/coverclock/com-diag-hazer

PROGRAM=$(basename -s .sh ${0})
DEVICE=${1:-"/dev/ttyACM0"}
RATE=${2:-9600}
INTERVAL=${3:-1}
WRITE=${4:-1}

. $(readlink -e $(dirname ${0})/../bin)/setup

LOG=$(readlink -e $(dirname ${0})/..)/log
mkdir -p ${LOG}

# CONFIG_RATE
# CONFIG_MSG_NMEA_STD_GGA
# CONFIG_MSG_NMEA_STD_GLL
# CONFIG_MSG_NMEA_STD_GSA
# CONFIG_MSG_NMEA_STD_GSV
# CONFIG_MSG_NMEA_STD_RMC
# CONFIG_MSG_NMEA_STD_VTG
# CONFIG_MSG_NMEA_STD_GRS
# CONFIG_MSG_NMEA_STD_GST
# CONFIG_MSG_NMEA_STD_ZDA
# CONFIG_MSG_NMEA_STD_GBS
# CONFIG_MSG_NMEA_STD_DTM
# CONFIG_MSG_NMEA_STD_GGA
# CONFIG_MSG_NMEA_UBX_PUBX_00
# CONFIG_MSG_NMEA_UBX_PUBX_03
# CONFIG_MSG_NMEA_UBX_PUBX_04
# CONFIG_GNSS_GPS_SBAS

# N.B. The u-blox module in the BU353W10 reports it uses Port 4 (one-based).
 
exec coreable gpstool \
	-D ${DEVICE} -b ${RATE} -8 -n -1 -i ${INTERVAL} \
	-w ${WRITE} \
	-x \
	-A '\xB5\x62\x06\x08\x06\x00\xe8\x03\x01\x00\x01\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x00\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x01\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x02\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x03\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x04\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x05\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x06\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x07\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x08\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x09\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x0a\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF0\x00\x00\x00\x00\x00\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF1\x00\x00\x00\x00\x01\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF1\x03\x00\x00\x00\x01\x00\x00' \
	-A '\xB5\x62\x06\x01\x08\x00\xF1\x04\x00\x00\x00\x01\x00\x00' \
	-A '\xB5\x62\x06\x3E\x3C\x00\x00\x00\xFF\x07\x00\x08\x10\x00\x01\x00\x01\x00\x01\x01\x03\x00\x00\x00\x00\x00\x02\x04\x08\x00\x00\x00\x00\x00\x03\x08\x10\x00\x00\x00\x00\x00\x04\x00\x08\x00\x00\x00\x00\x00\x05\x00\x03\x00\x01\x00\x01\x00\x06\x08\x0e\x00\x01\x00\x01\x00' \
	-E -v 2> ${LOG}/${PROGRAM}.err
